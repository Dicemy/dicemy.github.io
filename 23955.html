<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Hyperledger fabric开发入门 - Dicemy 的博客</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Dicemy"><meta name="msapplication-TileImage" content="/img/biaoti.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Dicemy"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="注意：不要在有生产环境的服务器上进行学习测试，（docker-compose关闭服务的时候会清除服务器上所有正在运行的的docker容器） 参考课程：CSDN_超级账本智能合约与DApp"><meta property="og:type" content="blog"><meta property="og:title" content="Hyperledger fabric开发入门"><meta property="og:url" content="https://dicemy.com/23955"><meta property="og:site_name" content="Dicemy 的博客"><meta property="og:description" content="注意：不要在有生产环境的服务器上进行学习测试，（docker-compose关闭服务的时候会清除服务器上所有正在运行的的docker容器） 参考课程：CSDN_超级账本智能合约与DApp"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202202150113550.png"><meta property="article:published_time" content="2022-01-08T10:08:35.000Z"><meta property="article:modified_time" content="2022-02-16T00:53:45.223Z"><meta property="article:author" content="Dicemy"><meta property="article:tag" content="Hyperledger fabric"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202202150113550.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://dicemy.com/23955"},"headline":"Hyperledger fabric开发入门","image":["https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202202150113550.png"],"datePublished":"2022-01-08T10:08:35.000Z","dateModified":"2022-02-16T00:53:45.223Z","author":{"@type":"Person","name":"Dicemy"},"publisher":{"@type":"Organization","name":"Dicemy 的博客","logo":{"@type":"ImageObject","url":"https://dicemy.com/img/biaoti.png"}},"description":"注意：不要在有生产环境的服务器上进行学习测试，（docker-compose关闭服务的时候会清除服务器上所有正在运行的的docker容器） 参考课程：CSDN_超级账本智能合约与DApp"}</script><link rel="canonical" href="https://dicemy.com/23955"><link rel="icon" href="/img/biaoti.png"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.15.2/css/all.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><link rel="dns-prefetch" href="http://dicemy.com/"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/cookieconsent/3.1.1/cookieconsent.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/lightgallery/1.10.0/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.8.1/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=G-3BC8TV17YR" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'G-3BC8TV17YR');</script><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdnjs.loli.net/ajax/libs/pace/1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.0.0"><link rel="stylesheet" href="/css/prism.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/biaoti.png" alt="Dicemy 的博客" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">首页</a><a class="navbar-item" href="/archives">时间轴</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/about">关于我</a></div><div class="navbar-end"><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-9-widescreen"><div class="card"><div class="card-image"><span class="image is-7by3"><img class="fill" src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202202150113550.png" alt="Hyperledger fabric开发入门"></span></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-01-08T10:08:35.000Z" title="2022/1/8 下午6:08:35">2022-01-08</time>发表</span><span class="level-item"><time dateTime="2022-02-16T00:53:45.223Z" title="2022/2/16 上午8:53:45">2022-02-16</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E6%8A%80%E6%9C%AF/">技术</a></span><span class="level-item">1 小时读完 (大约7687个字)</span><span class="level-item" id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span>次访问</span></div></div><h1 class="title is-3 is-size-4-mobile">Hyperledger fabric开发入门</h1><div class="content"><p><strong>注意</strong>：不要在有生产环境的服务器上进行学习测试，（docker-compose关闭服务的时候会清除服务器上所有正在运行的的docker容器）</p>
<p>参考课程：<a target="_blank" rel="noopener" href="https://edu.csdn.net/course/detail/32721">CSDN_超级账本智能合约与DApp</a></p>
<span id="more"></span>

<h1 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h1><h2 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h2><p>在gopath中创建</p>
<blockquote>
<p>mkdir src</p>
<p>mkdir bin</p>
<p>mkdir pkg</p>
</blockquote>
<p>在src中创建<code>mkdir github.com</code></p>
<p>在github.com中创建<code>mkdir hyperledger</code></p>
<h2 id="docker安装"><a href="#docker安装" class="headerlink" title="docker安装"></a>docker安装</h2><p>一行命令，完成安装：（安装之后记得要把docker服务启动起来）</p>
<blockquote>
<p>curl -sSL <a target="_blank" rel="noopener" href="https://get.daocloud.io/docker">https://get.daocloud.io/docker</a> | sh</p>
<p>service docker start </p>
</blockquote>
<p>而且源在国内</p>
<h2 id="docker-compose安装"><a href="#docker-compose安装" class="headerlink" title="docker-compose安装"></a>docker-compose安装</h2><p>通过curl进行安装：</p>
<blockquote>
<p><code>curl -L https://github.com/docker/compose/releases/download/1.7.0/docker-compose-``uname -s ``-``uname -m`` &gt; /usr/local/bin/docker-compose</code></p>
<p><code>chmod +x /usr/local/bin/docker-compose</code></p>
<p><code>docker-compose -v</code></p>
</blockquote>
<h2 id="go安装与配置"><a href="#go安装与配置" class="headerlink" title="go安装与配置"></a>go安装与配置</h2><p>参考：<a href="http://dicemy.com/29920#Go%E8%AF%AD%E8%A8%80%E5%AE%89%E8%A3%85">http://dicemy.com/29920#Go%E8%AF%AD%E8%A8%80%E5%AE%89%E8%A3%85</a></p>
<p>一定要注意环境变量的配置</p>
<h2 id="jdk安装"><a href="#jdk安装" class="headerlink" title="jdk安装"></a>jdk安装</h2><blockquote>
<p>yum list java*</p>
<p>yum install -y java-1.8.0-openjdk-devel.x86_64    </p>
<p>java -version</p>
</blockquote>
<h2 id="下载fabric的docker镜像"><a href="#下载fabric的docker镜像" class="headerlink" title="下载fabric的docker镜像"></a>下载fabric的docker镜像</h2><p>除了baseos下载0.3.1，其余都下1.0.0，然后标记为latest</p>
<blockquote>
<p>tools：docker pull hyperledger/fabric-tools:x86_64-1.0.0</p>
<p>ccenv：docker pull hyperledger/fabric-ccenv:x86_64-1.0.0</p>
<p>ca：docker pull hyperledger/fabric-ca:x86_64-1.0.0</p>
<p>orderer：docker pull hyperledger/fabric-orderer:x86_64-1.0.0</p>
<p>peer：docker pull hyperledger/fabric-peer:x86_64-1.0.0</p>
<p>baseos：docker pull hyperledger/fabric-baseos:x86_64-0.3.1</p>
</blockquote>
<p>纯命令版：</p>
<blockquote>
<p>docker pull hyperledger/fabric-tools:x86_64-1.0.0</p>
<p>docker pull hyperledger/fabric-ccenv:x86_64-1.0.0</p>
<p>docker pull hyperledger/fabric-ca:x86_64-1.0.0</p>
<p>docker pull hyperledger/fabric-orderer:x86_64-1.0.0</p>
<p>docker pull hyperledger/fabric-peer:x86_64-1.0.0</p>
<p>docker pull hyperledger/fabric-baseos:x86_64-0.3.1</p>
</blockquote>
<p>注意：记得在所有的安装之后进行tag 编辑成latest状态否则会出现问题</p>
<p><code>docker tag xxxx xxxx:latest</code></p>
<blockquote>
<p>docker tag hyperledger/fabric-tools:x86_64-1.0.0 hyperledger/fabric-tools:latest</p>
<p>docker tag hyperledger/fabric-ccenv:x86_64-1.0.0 hyperledger/fabric-ccenv:latest</p>
<p>docker tag hyperledger/fabric-ca:x86_64-1.0.0 hyperledger/fabric-ca:latest</p>
<p>docker tag hyperledger/fabric-orderer:x86_64-1.0.0 hyperledger/fabric-orderer:latest</p>
<p>docker tag hyperledger/fabric-peer:x86_64-1.0.0 hyperledger/fabric-peer:latest</p>
<p>docker tag hyperledger/fabric-baseos:x86_64-0.3.1 hyperledger/fabric-baseos:latest</p>
</blockquote>
<h2 id="下载fabric源码库"><a href="#下载fabric源码库" class="headerlink" title="下载fabric源码库"></a>下载fabric源码库</h2><p>在hyperledger目录下进行<code>git clone https://github.com/hyperledger/fabric.git</code></p>
<p><code>git checkout release-1.0</code></p>
<p><code>cd /home/gopath/src/github.com/hyperledger/fabric/common/configtx/tool/configtxgen</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/20220108181212.png" alt="image-20220108181210078"></p>
<h3 id="对工具进行编译。"><a href="#对工具进行编译。" class="headerlink" title="对工具进行编译。"></a>对工具进行编译。</h3><p><code>go install --tags=nopkcs11</code></p>
<blockquote>
<p>注意！！！</p>
<p>奇怪的错误请输入：go env -w GO111MODULE=auto</p>
<p>一定要把这个项目文件的src放在go环境设置下的gopath的文件夹中，输入go env可以查看go安装环境中的gopath文件夹。否则会出现找不到包的报错。</p>
</blockquote>
<h3 id="对另一个工具进行编译。"><a href="#对另一个工具进行编译。" class="headerlink" title="对另一个工具进行编译。"></a>对另一个工具进行编译。</h3><p><code>cd /home/gopath/src/github.com/hyperledger/fabric/common/tools/cryptogen</code></p>
<p><code>go install --tags=nopkcs11</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/20220108183050.png" alt="image-20220108183049804"></p>
<h3 id="编译好的工具如下"><a href="#编译好的工具如下" class="headerlink" title="编译好的工具如下:"></a>编译好的工具如下:</h3><p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/20220108183258.png" alt="image-20220108183258043"></p>
<h2 id="下载fabric-samples"><a href="#下载fabric-samples" class="headerlink" title="下载fabric-samples"></a>下载fabric-samples</h2><p><code>cd /home/gopath/src/github.com/hyperledger</code></p>
<p><code>git clone https://github.com/hyperledger/fabric-samples.git</code></p>
<p><code>git checkout release-1.0</code></p>
<h1 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello World"></a>Hello World</h1><h2 id="1-查看目录"><a href="#1-查看目录" class="headerlink" title="1.查看目录"></a>1.查看目录</h2><p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/20220108185207.png" alt="image-20220108185207083"></p>
<p>.env：存储一些环境变量</p>
<p>base：储存docker-compose的一些公共服务</p>
<p>byfn.sh：执行脚本</p>
<p>configtx.yaml和crypto-config.yaml：根据之前生成的2个工具，生成相应的配置文件，用来启动网络，放到当前目录的channel-artifacts和crypto-config里面</p>
<p>docker-compose：用于启动网络</p>
<p>scripts：存放测试脚本，做的事：创建通道，加入通道，安装链码，实例化链码，链码交互</p>
<h2 id="2-生成配置"><a href="#2-生成配置" class="headerlink" title="2.生成配置"></a>2.生成配置</h2><p><code>./byfn.sh -m generate -i 1.0.0</code></p>
<blockquote>
<p>注意！！！！</p>
<p>一定要记得吧gopath中的bin目录添加到环境变量中，否则可能无法调用刚才编译好的configtxgen和cryptogen工具</p>
<p>可以通过 export PATH=$PATH:/home/gopath/bin 来临时添加或者使用vim ~/.bash_profile修改PATH 一行，之后使用source ~/.bash_profile生效。</p>
</blockquote>
<h2 id="3-启动网络，自动运行测试脚本"><a href="#3-启动网络，自动运行测试脚本" class="headerlink" title="3.启动网络，自动运行测试脚本"></a>3.启动网络，自动运行测试脚本</h2><p><code>./byfn.sh -m up -i 1.0.0</code></p>
<h2 id="4-关闭网络，自动清楚配置和docker进程"><a href="#4-关闭网络，自动清楚配置和docker进程" class="headerlink" title="4.关闭网络，自动清楚配置和docker进程"></a>4.关闭网络，自动清楚配置和docker进程</h2><p><code>./byfn.sh -m down -i 1.0.0</code></p>
<h1 id="Hello-World-分析"><a href="#Hello-World-分析" class="headerlink" title="Hello World 分析"></a>Hello World 分析</h1><h2 id="1-查看日志，order和peer分离"><a href="#1-查看日志，order和peer分离" class="headerlink" title="1.查看日志，order和peer分离"></a>1.查看日志，order和peer分离</h2><p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/20220108200634.png" alt="image-20220108200633311"></p>
<p>peer是按照组织或主体分离的，每一个组织生成ca（存储证书和私钥），msp（存储管理员证书和中间证书），peers（存储每一个peer相关的证书），users（存储每一个用户的证书）</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/20220108200948.png" alt="image-20220108200946765"></p>
<h2 id="2-查看如下配置"><a href="#2-查看如下配置" class="headerlink" title="2.查看如下配置"></a>2.查看如下配置</h2><p>genesis.block：整个网络的创世区块</p>
<p>channel.tx：创建的通道的配置</p>
<p>Org1MSPanchors.tx和Org2MSPanchors.tx：两个主体的锚节点配置</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/20220108201328.png" alt="image-20220108201327506"></p>
<h2 id="3-启动网络，接着分析日志"><a href="#3-启动网络，接着分析日志" class="headerlink" title="3.启动网络，接着分析日志"></a>3.启动网络，接着分析日志</h2><p>fabric网络启动完毕</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/20220108203247.png" alt="image-20220108203245854"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/20220108203353.png" alt="image-20220108203352910"></p>
<p>指定通道名称，和一些变量，通道创建完成</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/20220108203443.png" alt="image-20220108203442675"></p>
<p>4个peer加入通道</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/20220108203605.png" alt="image-20220108203604430"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/20220108203646.png" alt="image-20220108203646097"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/20220108203654.png" alt="image-20220108203653472"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/20220108203700.png" alt="image-20220108203659999"></p>
<p>组织中的锚节点在通道中update成功</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/20220108203742.png" alt="image-20220108203742026"></p>
<img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/20220108203742.png"/>

<p>链码安装到了peer节点</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/20220108203904.png" alt="image-20220108203903845"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/20220108203931.png" alt="image-20220108203930729"></p>
<p>链码实例化</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/20220108203952.png" alt="image-20220108203951359"></p>
<p>在peer0上进行查询操作，成功</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/20220108204015.png" alt="image-20220108204015033"></p>
<p>圈圈的是查询结果，查询成功，查询结果为100</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/20220108204137.png" alt="image-20220108204136547"></p>
<p>进行修改操作，成功</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/20220108204241.png" alt="image-20220108204241010"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/20220108204349.png" alt="image-20220108204348218"></p>
<p>再次查询，结果为90</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/20220108204508.png" alt="image-20220108204508197"></p>
<p>查看docker进程</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/20220109165719.png" alt="image-20220108204613817"></p>
<p>3个链码会生成3个image</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/20220108204746.png" alt="image-20220108204745898"></p>
<p>查看脚本</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/20220108205435.png" alt="image-20220108205434573"></p>
<p>可以按脚本中的位置找到链码</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/20220108205512.png" alt="image-20220108205511945"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/20220108205325.png" alt="image-20220108205320115"></p>
<p>实现了Init和Invoke接口，就代表是一个fabric智能合约</p>
<p>Init：首先获取参数，不为4个则报错，最终将A和B存到数据库中</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/20220108210007.png" alt="image-20220108210006159"></p>
<p>Invoke：设置了3个方法，（invoke，delete，query）</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/20220108210201.png" alt="image-20220108210200287"></p>
<p>invoke：接受3个参数，（谁给谁转账，赚多少）</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/20220108210300.png" alt="image-20220108210259542"></p>
<p>A给B转账。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/20220108210352.png" alt="image-20220108210352036"></p>
<p>持久化数据</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/20220108210442.png" alt="image-20220108210441191"></p>
<p>接受1个值，从数据库中删除</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/20220108211352.png" alt="image-20220108211350759"></p>
<p>查询操作，结果以json形式返回</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/20220108211533.png" alt="image-20220108211532979"></p>
<p>main里只start或者进行一些验证，不写其他代码</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/20220108211617.png" alt="image-20220108211616503"></p>
<p>srcipts中：初始化操作，A有100元，B有200元</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/20220108211813.png" alt="image-20220108211812427"></p>
<p>查询A有多少钱，所以打印了100</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/20220108211920.png" alt="image-20220108211919875"></p>
<p>A给B转账10元</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/20220108212005.png" alt="image-20220108212004943"></p>
<h1 id="fabric系统架构"><a href="#fabric系统架构" class="headerlink" title="fabric系统架构"></a>fabric系统架构</h1><h2 id="架构图"><a href="#架构图" class="headerlink" title="架构图"></a>架构图</h2><p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/20220109153233.png" alt="image-20220109153232452"></p>
<ul>
<li><p><strong>应用层</strong></p>
</li>
<li><p>API：提供了GRPC，（谷歌）RPC框架</p>
</li>
<li><p>SDK：在API基础上封装的SDK，go，java，python，nodejs</p>
</li>
<li><p>事件：分布式系统中，达成共识需要一定的时间，fabric使用异步通信模式开发，触发回调函数执行。</p>
</li>
<li><p>身份：依托于底层的成员服务，是联盟链的认证功能，例如CA</p>
</li>
<li><p>账本：区块链的查询数据，是账本中查出来的，区块高度+交易ID，不重复</p>
</li>
<li><p>交易：对区块链数据进行修改，先提交交易到背书节点，签名认证之后再执行。</p>
</li>
<li><p>智能合约：做合约的安装，实例化和升级</p>
</li>
<li><p><strong>区块链底层</strong></p>
</li>
<li><p>成员服务：提供证书，用于加密和签名</p>
</li>
<li><p>共识服务：CAP（不能全满足，只能满足2个，一致性，可用性和分区容忍性），实际上区块链是弱化了可用性和分区容忍性，所以需要共识算法保证一致性。fabric的共识大概分为三个阶段：</p>
<ul>
<li>首先客户端向背书节点发送一个背书提案，背书节点进行交易模拟，将背书节点和签名返回客户端。</li>
<li>然后将背书后的交易，交给排序节点进行排序。有排序节点生成区块，向全网广播。网络节点接受到广播后，先验证区块交易的正确性。</li>
<li>验证通过后，存入本地账本。</li>
<li>PS：排序节点与组织的锚节点使用的是GRPC通信，组织内使用的是gossip协议通信</li>
</ul>
</li>
<li><p>链码服务：提供安全的，可隔离的交易环境。所以fabric使用docker，链码直接与docker通信。目前阶段对k8s支持的不好，会出问题。</p>
</li>
<li><p>安全及密码服务：fabric定义了一个BCCSP接口，定义签名，加密解密功能，是默认实现了一套国际通用的密码服务，如sha256等</p>
</li>
</ul>
<h2 id="网络拓扑图"><a href="#网络拓扑图" class="headerlink" title="网络拓扑图"></a>网络拓扑图</h2><p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/20220109160034.png" alt="image-20220109160033781"></p>
<ul>
<li><strong>概念：</strong></li>
<li>客户端节点：应用程序和底层的交互媒介，与上层和peer和orderer连接发挥作用，连接peer做交易模拟</li>
<li>peer节点：包含了<strong>锚节点（主节点）</strong>，在一个组织内可以有多个peer，一个组织中锚节点只有一个，锚节点的作用（与orderer进行通信），锚节点需要HA支持，若锚节点挂了，组织内会选举新的节点与orderer节点进行通信，<strong>背书节点（Endorse）</strong>理解为担保，与智能合约绑定的，每一个智能合约安装到区块链中，会有一个专属的背书策略，<strong>记账节点（committer）</strong>所有的peer节点都是记账节点。用于验证从orderer接受的区块，验证交易的有效性，验证通过后，同步到本地账本。</li>
<li>orderer节点：排序节点，接受全网客户端节点的交易信息，按照一定规则进行排序，将排序好的交易，按照固定的时间间隔打包成区块。与其他组织的主节点进行通信，排序可以用solo（整个网络中只有一个排序节点，使用于开发和测试）和kafka（生产环境下使用，分布式消息队列）模式</li>
<li>CA节点：可选的，作用：颁发证书，只用被CA认证的节点才能进行交易，fabric不存在51%攻击问题。</li>
<li><strong>动作和行为：</strong></li>
<li>注册登记：与客户端发起，向CA机构表明自己的身份，获取证书，上图中是第三方的CA，也可以使用官方提供的CA。</li>
<li>交易提案：向组织的<strong>背书节点</strong>提交请求，对应peer节点，组织可以理解为现实中的商业主体，组织是独立的，有两个个数据来源。</li>
<li>提交交易：客户端节点向排序节点发请求，orderer内部进行排序打包成区块，广播给其他组织的锚节点，上图是基于kafka实现的，每个组织会选择一个orderer节点进行通信。</li>
</ul>
<h2 id="交易流程"><a href="#交易流程" class="headerlink" title="交易流程"></a>交易流程</h2><ul>
<li>客户端提交交易，最终到记账节点同步数据。</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/20220109163002.png" alt="image-20220109163001787"></p>
<ul>
<li>智能合约按照要指定背书节点，正常情况下，背书节点返回相同的结果，但签名是不一样的。</li>
<li>背书是模拟的过程，不会持久化</li>
<li>1,2,3是交易模拟，4,5,6是交易排序，7,8,9是交易同步和记账。交易模拟对应智能合约，交易排序对应共识机制，同步和记账对应账本存储</li>
</ul>
<h1 id="fabric共识排序"><a href="#fabric共识排序" class="headerlink" title="fabric共识排序"></a>fabric共识排序</h1><h2 id="共识机制"><a href="#共识机制" class="headerlink" title="共识机制"></a>共识机制</h2><ul>
<li>达成公式需要3个阶段，交易背书，交易排序，交易验证。</li>
<li>交易背书：模拟的</li>
<li>交易排序：确定交易顺序，最终将排序好的交易打包区块分发。</li>
<li>交易验证：区块储存前要进行一下交易验证（不是所有的orderer的东西都能存进去）</li>
</ul>
<h2 id="Orderer节点的作用"><a href="#Orderer节点的作用" class="headerlink" title="Orderer节点的作用"></a>Orderer节点的作用</h2><ul>
<li><p>交易排序</p>
<ul>
<li>目的：保证系统的最终一致性（有限状态机）</li>
<li>solo：单节点排序</li>
<li>kafka：外置的分布式消息队列</li>
</ul>
</li>
<li><p>区块分发：</p>
<ul>
<li>orderer中的区块并不是最终持久化的区块，</li>
<li>是一个中间状态的区块</li>
<li>包含了所有交易，不管是有有效还是无效，都会打包传给组织的锚节点。</li>
</ul>
</li>
<li><p>多通道的数据隔离</p>
<ul>
<li>客户端可以使用某个通道，发送交易</li>
<li><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/20220109164753.png" alt="image-20220109164752553"></li>
</ul>
</li>
</ul>
<h2 id="源码目录"><a href="#源码目录" class="headerlink" title="源码目录"></a>源码目录</h2><ul>
<li><p>从goland中阅读</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/20220110134631.png" alt="image-20220110134628351"></p>
</li>
<li><p>源码目录</p>
<ul>
<li>bccsp：与密码学相关的，加密，数字签名，证书，将密码学中的函数抽象成了接口，方便调用和扩展</li>
<li>bddtests：行为驱动开发，从需求直接到开发</li>
<li>common：公共库，错误处理，日志处理，账本存贮，相关工具</li>
<li>core：是fabric核心库，子目录是各个模块的目录<ul>
<li>comm：网络通信相关</li>
</ul>
</li>
<li>devenv：官方提供的开发环境，使用的是Vagrant</li>
<li>docs：文档</li>
<li>events：事件监听机制</li>
<li>gossip：通信协议，组织内部的通信，区块同步</li>
<li>gotools：用于编译</li>
<li>images：docker镜像相关的</li>
<li>msp：成员服务管理，member serivce provider 读取证书做签名</li>
<li>orderer：排序节点</li>
<li>peer：peer节点</li>
<li>proposals：用于扩展，新功能的提案</li>
<li>protos：数据结构的定义</li>
</ul>
</li>
<li><p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/20220110135049.png" alt="image-20220110135013312"></p>
</li>
</ul>
<h2 id="共识机制源码"><a href="#共识机制源码" class="headerlink" title="共识机制源码"></a>共识机制源码</h2><blockquote>
<p>如果使用goland查看源码时import全部标红的话，进入这个设置，将第一个Enable Go … 这个框勾掉即可。<img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/20220110140311.png" alt="image-20220110140310255"></p>
</blockquote>
<ul>
<li><p>orderer节点的源码</p>
</li>
<li><p>首先看orderer目录下的main.go</p>
</li>
<li><p>main.go里有一个NewServer</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/20220110145806.png" alt="image-20220110145805341"></p>
</li>
<li><p>从sever.go可以具体查看交易收集和广播区块</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/20220110145855.png" alt="image-20220110145853957"></p>
</li>
<li><p>点击Manager，进入Manager.go查看源码（还在sever.go里）</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/20220110150014.png" alt="image-20220110150005861"></p>
</li>
<li><p>点击chainsupport，查看（在manager.go中）<br><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/20220110153610.png" alt="image-20220110153609457"></p>
</li>
<li><p>点receiver进去，看区块切割（在chainsupport.go中）<br><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/20220110155258.png" alt="image-20220110155256319"></p>
</li>
</ul>
<h2 id="回顾共识机制源码"><a href="#回顾共识机制源码" class="headerlink" title="回顾共识机制源码"></a>回顾共识机制源码</h2><ul>
<li>main.go是入口，orderer节点的初始化</li>
<li>manager.go是控制中枢，是对链的操作，拿到chainsupport对象</li>
<li>chainsupport.go链对象额代理，与链式对应的关系</li>
<li>Cut（）方法是区块切割</li>
<li>solo和kafka相关的设置</li>
<li>sever.go有两个Handle，是交易收集和区块扩散的方法</li>
<li>将共识简化为了排序，最终一致性</li>
</ul>
<h1 id="fabric账本存储"><a href="#fabric账本存储" class="headerlink" title="fabric账本存储"></a>fabric账本存储</h1><h2 id="账本存储概念"><a href="#账本存储概念" class="headerlink" title="账本存储概念"></a>账本存储概念</h2><ul>
<li><p>peer节点做账本存储</p>
</li>
<li><p>orderer是临时存储区块，peer节点时账本存储的持久化，会改变世界状态。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/20220110163404.png" alt="image-20220110163210283"></p>
</li>
<li><p>文件系统，区块是存储为文件</p>
</li>
<li><p>区块索引，用于查询区块，是用levelDB实现的</p>
</li>
<li><p>状态数据库，一般村存放区块链最新状态，数据不需要HA，可以从文件系统再次获取，couchDB支持模糊查询</p>
</li>
</ul>
<h2 id="交易读写集"><a href="#交易读写集" class="headerlink" title="交易读写集"></a>交易读写集</h2><ul>
<li><p>回忆交易流程</p>
<ul>
<li>交易模拟<ul>
<li>在背书节点执行模拟时，最终返回交易读写集（RWset），告诉区块链在交易中读写了哪些数据</li>
</ul>
</li>
<li>交易排序</li>
<li>交易验证，交易验证后，更新世界状态，更新的就是读写集中的写集</li>
</ul>
</li>
<li><p>交易读写集的3个概念</p>
<ul>
<li>读集：包含键的列表，键的提交版本，读取赌赢的值，返回的是已提交的状态的值（读已提交），不能读取交易过程中写入的数据。</li>
<li>写集：包含键的列表，写入的数据的值，如果多次写入，以最后一次为准。</li>
<li>版本号：用区块高度和交易编号组成的。</li>
</ul>
</li>
<li><p>交易验证阶段是对读写集进行验证（验证读集）</p>
<ul>
<li>验证读集的版本号是和否等于世界状态的版本号</li>
</ul>
</li>
</ul>
<h2 id="账本存储相关概念"><a href="#账本存储相关概念" class="headerlink" title="账本存储相关概念"></a>账本存储相关概念</h2><ul>
<li><p>世界状态</p>
<ul>
<li>交易执行后，所有键的最新值</li>
</ul>
</li>
<li><p>历史数据索引（可选）</p>
</li>
<li><p>区块储存</p>
<ul>
<li>按照文件去存 blockfile_xxxx</li>
<li>文件大小是64M，若修改，需要重新编译peer源码</li>
<li>账本最大容量64M*</li>
</ul>
</li>
<li><p>区块读取</p>
<ul>
<li>区块文件流</li>
<li>区块流</li>
<li>迭代器</li>
</ul>
</li>
<li><p>区块索引</p>
<ul>
<li>键：区块高度，区块哈希，交易哈希</li>
<li>值：区块文件编号，文件内的偏移量，区块数据的长度</li>
</ul>
</li>
<li><p>区块提交</p>
</li>
<li><p>保存到文件</p>
</li>
</ul>
<h2 id="账本存储相关源码"><a href="#账本存储相关源码" class="headerlink" title="账本存储相关源码"></a>账本存储相关源码</h2><ul>
<li>从4方面看，读写集，状态数据， 历史数据，区块文件</li>
<li>可以先从core/ledger 下的 ledger_interface.go 中看大体结构</li>
<li><strong>读写集</strong>，分为交易读写集的生成和交易读写集的验证两个部分去看。<ul>
<li>交易读写集生成<ul>
<li>fabric/core/ledger/kvledger/txmgmt/txmgr/lockbasedtxmgr/lockbased_tx_simulator.go</li>
</ul>
</li>
<li>交易读写集验证<ul>
<li>fabric/core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go</li>
</ul>
</li>
</ul>
</li>
<li><strong>状态数据库</strong>：看levelDB的实现<ul>
<li>fabric/core/ledger/kvledger/txmgmt/statedb/stateleveldb/stateleveldb.go</li>
</ul>
</li>
<li><strong>历史数据库</strong>：看levelDB的实现<ul>
<li>fabric/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb.go</li>
</ul>
</li>
<li><strong>区块文件读取</strong><ul>
<li>fabric/common/ledger/blkstorage/fsblkstorage/fs_blockstore.go</li>
<li>区块流：fabric/common/ledger/blkstorage/fsblkstorage/block_stream.go</li>
</ul>
</li>
</ul>
<h2 id="账本存储相关源码总结"><a href="#账本存储相关源码总结" class="headerlink" title="账本存储相关源码总结"></a>账本存储相关源码总结</h2><ul>
<li>首先看了账本根存储的根目录的接口，从宏观上把握</li>
<li>交易读写集的生成和验证</li>
<li>数据库增删改查</li>
<li>要有一个没有实现的方法，数据剪裁的接口，可能去解决数据无限增长的处理</li>
</ul>
<h1 id="fabric智能合约"><a href="#fabric智能合约" class="headerlink" title="fabric智能合约"></a>fabric智能合约</h1><h2 id="智能合约"><a href="#智能合约" class="headerlink" title="智能合约"></a>智能合约</h2><p>fabric_asset配置好的文件下载：<a target="_blank" href="/doc/fabric_asset.zip">点击下载fabric_asset.zip</a></p>
<ul>
<li><p>执行环境：以太坊虚拟智能合约执行环境EVM，fabric执行环境是docker</p>
</li>
<li><p>链码</p>
<ul>
<li>是应用层和区块链底层的中间点</li>
<li>每一个链码执行环境是一个独立的docker</li>
<li>使用GRPC协议与背书节点通讯，只有背书节点才能运行智能合约</li>
</ul>
</li>
<li><p>链码的生命周期</p>
<ul>
<li>打包，智能合约的编写和编译</li>
<li>安装，将打包好的文件，上传到背书节点</li>
<li>实例化，实际的安装了，执行Init方法，只执行一次，构造函数</li>
<li>升级，升级和修复链码</li>
<li>交互，自己定义的方法的调用</li>
</ul>
</li>
<li><p>链码的交互流程</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/20220111130908.png" alt="image-20220111130907628"></p>
</li>
<li><p>系统链码（了解）</p>
<ul>
<li>LSCC：管理链码的生命周期</li>
<li>CSCC：配置管理链码，管理链的配置</li>
<li>QSCC：查询账本存储，是一个区块索引的外部服务</li>
<li>ESCC：交易背书的链码，交易执行后的链码进行封装签名，给客户端返回背书交易结果。</li>
<li>VSCC：交易验证的链码</li>
</ul>
</li>
<li><p>链码编程的接口</p>
<ul>
<li>Init()：链码初始化，只执行一次</li>
<li>Invoke()：链码的业务逻辑的编写</li>
<li>上面2个方法参数一样，参数是SDK的接口</li>
</ul>
</li>
<li><p>链码SDK的接口</p>
<ul>
<li>写代码再看</li>
</ul>
</li>
<li><p>一些注意点</p>
<ul>
<li>分布式多机多节点执行，链码会执行很多次</li>
<li>不写随机函数，交易会无效，多次执行不一样</li>
<li>系统时间不写，多机时间不一定一样</li>
</ul>
</li>
</ul>
<h2 id="网络搭建配置的实现"><a href="#网络搭建配置的实现" class="headerlink" title="网络搭建配置的实现"></a>网络搭建配置的实现</h2><ul>
<li><p><strong>crypto-config.yaml</strong>：用于配置组织节点的个数，参考firstnetwork去编写</p>
</li>
<li><p>编写好后，传到linux对应目录</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/20220111220422.png" alt="image-20220111220421700"></p>
</li>
<li><p>进入deploy目录，设置工作目录为当前目录</p>
<p><code>export FABRIC_CFG_PATH=$GOPATH/src/fabric_asset/deploy</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201112316260.png" alt="image-20220111231610245"></p>
</li>
<li><p>指定按照yaml文件生成配置</p>
<p><code>cryptogen generate --config=./crypto-config.yaml</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201112318839.png" alt="image-20220111231835718"></p>
</li>
<li><p><strong>configtx.yaml</strong>：用于区块联盟中的组织信息，配合名字和证书等的位置，参考firstnetwork去编写</p>
</li>
<li><p>编写好后，传到linux对应目录</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201112323346.png" alt="image-20220111220421700"></p>
</li>
<li><p>创建用于存放配置的目录</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201121625352.png" alt="image-20220112162508038"></p>
</li>
<li><p><strong>生成系统链的创世区块</strong></p>
</li>
<li><p>-profile 指定联盟配置，-outputBlock 指定存放的位置</p>
<p><code>configtxgen -profile OneOrgsOrdererGenesis -outputBlock ./config/genesis.block</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201121628296.png" alt="image-20220112162808968"></p>
</li>
<li><p><strong>生成通道的创世交易</strong></p>
</li>
<li><p>profile 指定业务联盟，outputCreateChannelTx存放的路径，插件的名字叫做mychannel</p>
<p><code>configtxgen -profile TwoOrgsChannel -outputCreateChannelTx ./config/mychannel.tx -channelID mychannel</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201131517067.png" alt="image-20220113151701675"></p>
<blockquote>
<p>注意：如果使用虚拟机为平台的话，会出现用ssh连接执行命令执行出错的情况发生，具体原因不详，但是在虚拟机上可以正常执行并生成成功。</p>
</blockquote>
</li>
<li><p><strong>生成两个组织锚节点的交易信息</strong></p>
<p><code>configtxgen -profile TwoOrgsChannel -outputAnchorPeersUpdate ./config/Org0MSPanchors.tx -channelID mychannel -asOrg Org0MSP</code></p>
<p><code>configtxgen -profile TwoOrgsChannel -outputAnchorPeersUpdate ./config/Org1MSPanchors.tx -channelID mychannel -asOrg Org1MSP</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201131532043.png" alt="image-20220113153247804"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201131534780.png" alt="image-20220113153436463"></p>
</li>
<li><p>将docker-compose.yaml拖进deploy目录</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201211329882.png" alt="image-20220114165038705"></p>
</li>
</ul>
<h2 id="启动网络"><a href="#启动网络" class="headerlink" title="启动网络"></a>启动网络</h2><ul>
<li><p><strong>启动docker，后台运行</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201141811282.png" alt="image-20220114181144436"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201211036361.png" alt="image-20220121103619727"></p>
</li>
<li><p>查看orderer节点的运行日志</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201211036157.png" alt="image-20220121103654831"></p>
</li>
<li><p>与客户端交互操作</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201211043457.png" alt="image-20220121104301852"></p>
</li>
<li><p><strong>创建通道</strong></p>
</li>
<li><p>-o 指定与哪个orderer节点进行通信，-c指定创建的通道名称，-f指定使用的文件</p>
<blockquote>
<p>出现的错误一般情况下是docker-compose中书写有误，e.g.映射路径中etc目录写成了ect</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201211206681.png" alt="image-20220121120625533"></p>
</li>
<li><p><strong>加入通道</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201211210517.png" alt="image-20220121121002769"></p>
</li>
<li><p>查看peer加入的通道列表：</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201211211163.png" alt="image-20220121121110870"></p>
</li>
<li><p><strong>指定主节点</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201211213553.png" alt="image-20220121121336157"></p>
</li>
<li><p><strong>基础网络完成了</strong></p>
</li>
</ul>
<hr>
<ul>
<li><p><strong>安装链码</strong></p>
</li>
<li><p>-n是安装的名字，-v是version，-l是使用的语言</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201211220565.png" alt="image-20220121122000349"></p>
</li>
<li><p><strong>克隆一个会话</strong>，交互执行peer0，查看安装的链码</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201211223314.png" alt="image-20220121122348993"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201211225618.png" alt="image-20220121122517281"></p>
</li>
<li><p><strong>链码实例化</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201211231478.png" alt="image-20220121123124872"></p>
</li>
<li><p>链码交互执行</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201211242449.png" alt="image-20220121124213503"></p>
</li>
<li><p>多次执行查询，得到的结果不同，因为invoke（）中使用了随机数，不要这么做。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201211245508.png" alt="image-20220121124536471"></p>
</li>
</ul>
<h1 id="fabric链码案例"><a href="#fabric链码案例" class="headerlink" title="fabric链码案例"></a>fabric链码案例</h1><h2 id="链码入门"><a href="#链码入门" class="headerlink" title="链码入门"></a>链码入门</h2><ul>
<li><p>编写hello.go，完成后，拖到linux对应目录</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201211306765.png" alt="image-20220121130639382"></p>
</li>
<li><p><strong>安装链码</strong></p>
</li>
<li><p>-n是安装的名字，-v是version，-l是使用的语言</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201211309023.png" alt="image-20220121130951831"></p>
</li>
<li><p>实例化链码</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201211314692.png" alt="image-20220121131431500"></p>
</li>
<li><p>链码调用</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201211316775.png" alt="image-20220121131610535"></p>
</li>
</ul>
<h2 id="账户相关链码"><a href="#账户相关链码" class="headerlink" title="账户相关链码"></a>账户相关链码</h2><ul>
<li><p>Init（）方法与例子程序类似</p>
</li>
<li><p>Invoke（）方法包含query，invoke，set，get，</p>
</li>
<li><p>编写完成后拖到linux对应目录</p>
</li>
<li><p>启动容器</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201211742920.png" alt="image-20220121174057468"></p>
</li>
<li><p>交互执行</p>
<img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201211742920.png"/>
</li>
<li><p>创建通道</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201211744978.png" alt="image-20220121174426685"></p>
</li>
<li><p>加入通道</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201211745648.png" alt="image-20220121174527349"></p>
</li>
<li><p>设置主节点</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201211747968.png" alt="image-20220121174721400"></p>
</li>
<li><p>安装链码</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201211749638.png" alt="image-20220121174953989"></p>
</li>
<li><p>实例化链码</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201211753092.png" alt="image-20220121175309884"></p>
</li>
<li><p>查询user1的余额</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201211756382.png" alt="image-20220121175634359"></p>
</li>
<li><p>user1给user2转200元</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201211758539.png" alt="image-20220121175842114"></p>
</li>
<li><p>向user1存100元</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201211800126.png" alt="image-20220121180038895"></p>
</li>
<li><p>向user1取200元</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201211801284.png" alt="image-20220121180152224"></p>
</li>
</ul>
<h2 id="贷款还款相关链码"><a href="#贷款还款相关链码" class="headerlink" title="贷款还款相关链码"></a>贷款还款相关链码</h2><ul>
<li><p>编写Trace下的代码，编写好后，拖到对应linux目录</p>
</li>
<li><p>保证网络基础OK的情况下，安装链码</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201221455452.png" alt="image-20220122145534672"></p>
</li>
<li><p>实例化链码</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201221458929.png" alt="image-20220122145831365"></p>
</li>
<li><p>运行测试</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201221500977.png" alt="image-20220122150047323"></p>
</li>
<li><p>贷款500W</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201221503934.png" alt="image-20220122150341567"></p>
</li>
<li><p>还款500</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201221505292.png" alt="image-20220122150527823"></p>
</li>
</ul>
<h2 id="公民身份信息相关链码"><a href="#公民身份信息相关链码" class="headerlink" title="公民身份信息相关链码"></a>公民身份信息相关链码</h2><ul>
<li><p>编写citizens下的代码，编写好后，拖到对应linux目录</p>
</li>
<li><p>安装链码</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201221913015.png" alt="image-20220122191304566"></p>
</li>
<li><p>链码实例化</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201221931645.png" alt="image-20220122193129390"></p>
</li>
<li><p>身份查询</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201221932544.png" alt="image-20220122193243135"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201221933442.png" alt="image-20220122193311699"></p>
</li>
</ul>
<h2 id="合约相关链码"><a href="#合约相关链码" class="headerlink" title="合约相关链码"></a>合约相关链码</h2><ul>
<li><p>编写contract下的代码，编写好后，拖到对应linux目录</p>
</li>
<li><p>安装链码</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201231513268.png" alt="image-20220123151326386"></p>
</li>
<li><p>链码实例化</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201231515006.png" alt="image-20220123151524636"></p>
</li>
<li><p>发布合约</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201231522057.png" alt="image-20220123152252818"></p>
</li>
<li><p>响应合约</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201231535519.png" alt="image-20220123153527155"></p>
</li>
<li><p>合约成交</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201231540970.png" alt="image-20220123154053895"></p>
</li>
<li><p>合约关闭</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201231541581.png" alt="image-20220123154120913"></p>
</li>
<li><p>查询合约的最新数据</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201231545995.png" alt="image-20220123154555108"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201231547838.png" alt="image-20220123154700388"></p>
</li>
<li><p>查询合约所有数据</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201231548214.png" alt="image-20220123154854036"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201231549077.png" alt="image-20220123154951755"></p>
</li>
</ul>
<h1 id="fabric链码案例-1"><a href="#fabric链码案例-1" class="headerlink" title="fabric链码案例"></a>fabric链码案例</h1><h2 id="流程整理"><a href="#流程整理" class="headerlink" title="流程整理"></a>流程整理</h2><ul>
<li>让什么数据上链<ul>
<li>所有节点备份数据耗费空间，视频等不要上链</li>
</ul>
</li>
<li>如何交互<ul>
<li>-c “Args”:[方法名，参数]</li>
</ul>
</li>
<li>编写合约<ul>
<li>Init</li>
<li>Invoke</li>
</ul>
</li>
<li>拖到linux运行，基于配置好的网络去部署运行（安装和实例化）</li>
<li>合约交互</li>
<li>SDK调用（页面点击或输入信息）</li>
</ul>
<h2 id="需求分析"><a href="#需求分析" class="headerlink" title="需求分析"></a>需求分析</h2><ul>
<li>开发转让资产</li>
<li>功能<ul>
<li>用户开户和销户</li>
<li>资产登记，资产上链，与具体的用户绑定</li>
<li>资产转让，资产的所有权变更</li>
<li>查询功能，用户查询，资产查询，资产变更的历史查询</li>
</ul>
</li>
<li>业务实体<ul>
<li>用户<ul>
<li>名字</li>
<li>身份证（表示）</li>
<li>资产列表</li>
</ul>
</li>
<li>资产<ul>
<li>名字</li>
<li>标识</li>
<li>特殊属性列表（车：排量，品牌，座位）</li>
</ul>
</li>
<li>资产的变更记录<ul>
<li>资产标识</li>
<li>资产的原始拥有者</li>
<li>资产变更后的拥有者</li>
</ul>
</li>
</ul>
</li>
<li>交互方法<ul>
<li>用户开户<ul>
<li>参数：名字，标识</li>
</ul>
</li>
<li>用户销户<ul>
<li>标识</li>
</ul>
</li>
<li>资产登记<ul>
<li>名字，标识，特殊属性列表，拥有者</li>
</ul>
</li>
<li>资产转让<ul>
<li>拥有者，资产标识，受让者</li>
</ul>
</li>
<li>用户查询<ul>
<li>参数：标识，返回值：用户实体</li>
</ul>
</li>
<li>资产查询<ul>
<li>参数：标识，返回值：资产实体</li>
</ul>
</li>
<li>资产的变更查询<ul>
<li>参数：资产标识，返回值：资产的变更列表</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="合约编写"><a href="#合约编写" class="headerlink" title="合约编写"></a>合约编写</h2><ul>
<li><p>合约编写完成，传到linux对应目录</p>
</li>
<li><p>创建通道的创世交易（channel名字不能有大写）</p>
</li>
<li><p>configtxgen -profile TwoOrgsChannel -outputCreateChannelTx ./config/assetschannel.tx -channelID assetschannel</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201272240598.png" alt="image-20220127224057055"></p>
<blockquote>
<p>如果出现这个提醒</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201272252094.png" alt="image-20220127225209757"></p>
<p>很有可能是<strong>FABRIC_CFG_PATH</strong>环境变量没有配置成功，可以直接在deploy目录下设置<code>export FABRIC_CFG_PATH=$PWD</code>再次执行该命令即可</p>
</blockquote>
</li>
<li><p>交互执行</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201272257319.png" alt="image-20220127225717142"></p>
</li>
<li><p>创建通道</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201272256365.png" alt="image-20220127225642703"></p>
</li>
<li><p>加入通道</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201272258425.png" alt="image-20220127225818220"></p>
</li>
<li><p>查看通道</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201272259992.png" alt="image-20220127225939825"></p>
</li>
<li><p>安装链码</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201272304218.png" alt="image-20220127230407170"></p>
</li>
<li><p>链码实例化</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201272306073.png" alt="image-20220127230612835"></p>
</li>
<li><p>注册</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201272312816.png" alt="image-20220127231250260"></p>
</li>
<li><p>用户查询</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201272317960.png" alt="image-20220127231727671"></p>
</li>
<li><p>资产登记</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201272316518.png" alt="image-20220127231633131"></p>
</li>
<li><p>资产查询，查询用户资产绑定</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201272318986.png" alt="image-20220127231840930"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201272321822.png" alt="image-20220127232101943"></p>
</li>
<li><p>注册了第二个用户</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201272322838.png" alt="image-20220127232251735"></p>
</li>
<li><p>资产转让</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201272328868.png" alt="image-20220127232819530"></p>
</li>
<li><p>查询用户二的用户状态</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201272330021.png" alt="image-20220127233036799"></p>
</li>
<li><p>查询资产一的状态</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201272330798.png" alt="image-20220127233020447"></p>
</li>
<li><p>查询所有资产的变更历史</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201272332821.png" alt="image-20220127233211273"></p>
</li>
<li><p>注销用户2，下面的资产也会随之注销</p>
</li>
</ul>
<h2 id="链码开发者模式"><a href="#链码开发者模式" class="headerlink" title="链码开发者模式"></a>链码开发者模式</h2><ul>
<li><p>将docker-compose关闭</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201281136004.png" alt="image-20220128113616795"></p>
</li>
<li><p>修改docker-compose配置</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201281138835.png" alt="image-20220128113801622"></p>
</li>
<li><p>运行docker</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201281138128.png" alt="image-20220128113841738"></p>
</li>
<li><p>在另一个会话找到编写好的智能合约</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201281142293.png" alt="image-20220128114238923"></p>
</li>
<li><p>运行链码</p>
<p><img src="https://cdn.jsdelivr.net/gh/Dicemy/blog-img/202201281154569.png" alt="image-20220128115426486"></p>
</li>
<li><p>在另一个会话进入交互执行</p>
</li>
<li><p>链码安装，实例化，调用之后，修改链码</p>
</li>
<li><p>将第二个，链码运行的对话ctrl+C结束，重新运行链码执行命令</p>
</li>
<li><p>注意：链码开发用这个模式没问题，SDK调用时，可能会出现问题，开发完智能合约关掉开发者模式</p>
</li>
</ul>
<h2 id="外部服务分析"><a href="#外部服务分析" class="headerlink" title="外部服务分析"></a>外部服务分析</h2><ul>
<li>如何提供外部服务<ul>
<li>企业内部各种数据接口，rpc，grpc</li>
<li>网站（web），手机（app），通过http</li>
<li>智能硬件，socket服务</li>
</ul>
</li>
<li>SDK提供外部服务，SDK的语言选择<ul>
<li>node.js（官方推荐，效率 9颗星）</li>
<li>java（实际使用量最大的 9颗星）</li>
<li>python（使用不太多 3颗星）</li>
<li>golang（不稳定，常用方法也没有，1颗星）</li>
</ul>
</li>
<li>SDK的模块<ul>
<li>区块链的管理：例如通道的创建和加入，链码的安装，实例化等</li>
<li>数据查询：区块和交易的查询</li>
<li>区块链交互（链码交互）：发起交易，invoke，query</li>
<li>事件监听：业务事件，系统事件</li>
</ul>
</li>
</ul>
<h2 id="SDK的下载和配置"><a href="#SDK的下载和配置" class="headerlink" title="SDK的下载和配置"></a>SDK的下载和配置</h2></div><div class="article-licensing box"><div class="licensing-title"><p>Hyperledger fabric开发入门</p><p><a href="https://dicemy.com/23955">https://dicemy.com/23955</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>Dicemy</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2022-01-08</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2022-02-16</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/Hyperledger-fabric/">Hyperledger fabric</a></div><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/social-share.js/1.0.16/css/share.min.css"><div class="social-share"></div><script src="https://cdnjs.loli.net/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3><div class="buttons is-centered"><a class="button donate" data-type="alipay"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>支付宝</span><span class="qrcode"><img src="/img/alipay.jpg" alt="支付宝"></span></a><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>微信</span><span class="qrcode"><img src="/img/wechatpay.jpg" alt="微信"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/40587"><i class="level-item fas fa-chevron-left"></i><span class="level-item">随笔-每天一句话</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/63228"><span class="level-item">树莓派入门</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><div class="content" id="valine-thread"></div><script src="//cdn.jsdelivr.net/npm/leancloud-storage@3/dist/av-min.js"></script><script src="https://cdnjs.loli.net/ajax/libs/valine/1.4.16/Valine.min.js"></script><script>new Valine({
            el: '#valine-thread',
            appId: "FE3KQNXvpvsHJmJl9idhXhp1-9Nh9j0Va",
            appKey: "CLLAhwQhbW5KCgp3CCPkAItO",
            placeholder: "输入你的评论\\n昵称为必填项目，在昵称处输入QQ号可以直接获取你的用户名和头像哦！",
            avatar: "mp",
            avatarForce: false,
            meta: ["nick","mail"],
            pageSize: 10,
            lang: "zh-CN",
            visitor: true,
            highlight: true,
            recordIP: false,
            
            
            
            enableQQ: false,
            requiredFields: [],
        });</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/touxiang.jpg" alt="Dicemy"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Dicemy</p><p class="is-size-6 is-block">一只菜鸡</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>中国 · 开封</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">37</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">4</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">19</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="http://dicemy.com/about/" target="_blank" rel="noopener">关于我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/Dicemy"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="QQ" href="tencent://message/?uin=1583925267"><i class="fab fa-qq"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Bilibili" href="https://space.bilibili.com/16023197"><i class="fas fa-tv"></i></a></div></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="level is-mobile" href="#环境配置"><span class="level-left"><span class="level-item">1</span><span class="level-item">环境配置</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#目录结构"><span class="level-left"><span class="level-item">1.1</span><span class="level-item">目录结构</span></span></a></li><li><a class="level is-mobile" href="#docker安装"><span class="level-left"><span class="level-item">1.2</span><span class="level-item">docker安装</span></span></a></li><li><a class="level is-mobile" href="#docker-compose安装"><span class="level-left"><span class="level-item">1.3</span><span class="level-item">docker-compose安装</span></span></a></li><li><a class="level is-mobile" href="#go安装与配置"><span class="level-left"><span class="level-item">1.4</span><span class="level-item">go安装与配置</span></span></a></li><li><a class="level is-mobile" href="#jdk安装"><span class="level-left"><span class="level-item">1.5</span><span class="level-item">jdk安装</span></span></a></li><li><a class="level is-mobile" href="#下载fabric的docker镜像"><span class="level-left"><span class="level-item">1.6</span><span class="level-item">下载fabric的docker镜像</span></span></a></li><li><a class="level is-mobile" href="#下载fabric源码库"><span class="level-left"><span class="level-item">1.7</span><span class="level-item">下载fabric源码库</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#对工具进行编译。"><span class="level-left"><span class="level-item">1.7.1</span><span class="level-item">对工具进行编译。</span></span></a></li><li><a class="level is-mobile" href="#对另一个工具进行编译。"><span class="level-left"><span class="level-item">1.7.2</span><span class="level-item">对另一个工具进行编译。</span></span></a></li><li><a class="level is-mobile" href="#编译好的工具如下"><span class="level-left"><span class="level-item">1.7.3</span><span class="level-item">编译好的工具如下:</span></span></a></li></ul></li><li><a class="level is-mobile" href="#下载fabric-samples"><span class="level-left"><span class="level-item">1.8</span><span class="level-item">下载fabric-samples</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Hello-World"><span class="level-left"><span class="level-item">2</span><span class="level-item">Hello World</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#1-查看目录"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">1.查看目录</span></span></a></li><li><a class="level is-mobile" href="#2-生成配置"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">2.生成配置</span></span></a></li><li><a class="level is-mobile" href="#3-启动网络，自动运行测试脚本"><span class="level-left"><span class="level-item">2.3</span><span class="level-item">3.启动网络，自动运行测试脚本</span></span></a></li><li><a class="level is-mobile" href="#4-关闭网络，自动清楚配置和docker进程"><span class="level-left"><span class="level-item">2.4</span><span class="level-item">4.关闭网络，自动清楚配置和docker进程</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Hello-World-分析"><span class="level-left"><span class="level-item">3</span><span class="level-item">Hello World 分析</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#1-查看日志，order和peer分离"><span class="level-left"><span class="level-item">3.1</span><span class="level-item">1.查看日志，order和peer分离</span></span></a></li><li><a class="level is-mobile" href="#2-查看如下配置"><span class="level-left"><span class="level-item">3.2</span><span class="level-item">2.查看如下配置</span></span></a></li><li><a class="level is-mobile" href="#3-启动网络，接着分析日志"><span class="level-left"><span class="level-item">3.3</span><span class="level-item">3.启动网络，接着分析日志</span></span></a></li></ul></li><li><a class="level is-mobile" href="#fabric系统架构"><span class="level-left"><span class="level-item">4</span><span class="level-item">fabric系统架构</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#架构图"><span class="level-left"><span class="level-item">4.1</span><span class="level-item">架构图</span></span></a></li><li><a class="level is-mobile" href="#网络拓扑图"><span class="level-left"><span class="level-item">4.2</span><span class="level-item">网络拓扑图</span></span></a></li><li><a class="level is-mobile" href="#交易流程"><span class="level-left"><span class="level-item">4.3</span><span class="level-item">交易流程</span></span></a></li></ul></li><li><a class="level is-mobile" href="#fabric共识排序"><span class="level-left"><span class="level-item">5</span><span class="level-item">fabric共识排序</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#共识机制"><span class="level-left"><span class="level-item">5.1</span><span class="level-item">共识机制</span></span></a></li><li><a class="level is-mobile" href="#Orderer节点的作用"><span class="level-left"><span class="level-item">5.2</span><span class="level-item">Orderer节点的作用</span></span></a></li><li><a class="level is-mobile" href="#源码目录"><span class="level-left"><span class="level-item">5.3</span><span class="level-item">源码目录</span></span></a></li><li><a class="level is-mobile" href="#共识机制源码"><span class="level-left"><span class="level-item">5.4</span><span class="level-item">共识机制源码</span></span></a></li><li><a class="level is-mobile" href="#回顾共识机制源码"><span class="level-left"><span class="level-item">5.5</span><span class="level-item">回顾共识机制源码</span></span></a></li></ul></li><li><a class="level is-mobile" href="#fabric账本存储"><span class="level-left"><span class="level-item">6</span><span class="level-item">fabric账本存储</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#账本存储概念"><span class="level-left"><span class="level-item">6.1</span><span class="level-item">账本存储概念</span></span></a></li><li><a class="level is-mobile" href="#交易读写集"><span class="level-left"><span class="level-item">6.2</span><span class="level-item">交易读写集</span></span></a></li><li><a class="level is-mobile" href="#账本存储相关概念"><span class="level-left"><span class="level-item">6.3</span><span class="level-item">账本存储相关概念</span></span></a></li><li><a class="level is-mobile" href="#账本存储相关源码"><span class="level-left"><span class="level-item">6.4</span><span class="level-item">账本存储相关源码</span></span></a></li><li><a class="level is-mobile" href="#账本存储相关源码总结"><span class="level-left"><span class="level-item">6.5</span><span class="level-item">账本存储相关源码总结</span></span></a></li></ul></li><li><a class="level is-mobile" href="#fabric智能合约"><span class="level-left"><span class="level-item">7</span><span class="level-item">fabric智能合约</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#智能合约"><span class="level-left"><span class="level-item">7.1</span><span class="level-item">智能合约</span></span></a></li><li><a class="level is-mobile" href="#网络搭建配置的实现"><span class="level-left"><span class="level-item">7.2</span><span class="level-item">网络搭建配置的实现</span></span></a></li><li><a class="level is-mobile" href="#启动网络"><span class="level-left"><span class="level-item">7.3</span><span class="level-item">启动网络</span></span></a></li></ul></li><li><a class="level is-mobile" href="#fabric链码案例"><span class="level-left"><span class="level-item">8</span><span class="level-item">fabric链码案例</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#链码入门"><span class="level-left"><span class="level-item">8.1</span><span class="level-item">链码入门</span></span></a></li><li><a class="level is-mobile" href="#账户相关链码"><span class="level-left"><span class="level-item">8.2</span><span class="level-item">账户相关链码</span></span></a></li><li><a class="level is-mobile" href="#贷款还款相关链码"><span class="level-left"><span class="level-item">8.3</span><span class="level-item">贷款还款相关链码</span></span></a></li><li><a class="level is-mobile" href="#公民身份信息相关链码"><span class="level-left"><span class="level-item">8.4</span><span class="level-item">公民身份信息相关链码</span></span></a></li><li><a class="level is-mobile" href="#合约相关链码"><span class="level-left"><span class="level-item">8.5</span><span class="level-item">合约相关链码</span></span></a></li></ul></li><li><a class="level is-mobile" href="#fabric链码案例-1"><span class="level-left"><span class="level-item">9</span><span class="level-item">fabric链码案例</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#流程整理"><span class="level-left"><span class="level-item">9.1</span><span class="level-item">流程整理</span></span></a></li><li><a class="level is-mobile" href="#需求分析"><span class="level-left"><span class="level-item">9.2</span><span class="level-item">需求分析</span></span></a></li><li><a class="level is-mobile" href="#合约编写"><span class="level-left"><span class="level-item">9.3</span><span class="level-item">合约编写</span></span></a></li><li><a class="level is-mobile" href="#链码开发者模式"><span class="level-left"><span class="level-item">9.4</span><span class="level-item">链码开发者模式</span></span></a></li><li><a class="level is-mobile" href="#外部服务分析"><span class="level-left"><span class="level-item">9.5</span><span class="level-item">外部服务分析</span></span></a></li><li><a class="level is-mobile" href="#SDK的下载和配置"><span class="level-left"><span class="level-item">9.6</span><span class="level-item">SDK的下载和配置</span></span></a></li></ul></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/biaoti.png" alt="Dicemy 的博客" height="28"></a><p class="is-size-7"><span>&copy; 2022 Dicemy</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">共<span id="busuanzi_value_site_uv">0</span>个访客, <span id="busuanzi_value_site_pv">0</span>次访问</span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="知识共享" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="CC BY-NC 4.0" href="https://creativecommons.org/licenses/by-nc/4.0/deed.zh"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/Dicemy"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdnjs.loli.net/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="https://cdnjs.loli.net/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script><script src="https://cdnjs.loli.net/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/cookieconsent/3.1.1/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdnjs.loli.net/ajax/libs/lightgallery/1.10.0/js/lightgallery.min.js" defer></script><script src="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>